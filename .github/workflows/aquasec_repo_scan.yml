name: AquaSec Full Repository Scan

on:
  workflow_dispatch:
  pull_request:
    types: [ opened ]

permissions:
  contents: read
  issues: write
  pull-requests: write
  security-events: write

concurrency:
  group: aquasec-scan-${{ github.ref }}
  cancel-in-progress: true

jobs:
  aquasec-scanning:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8
        with:
          persist-credentials: false
          fetch-depth: 0

      - name: Verify SARIF file exists
        run: |
          if [ ! -f "test_aquasec_scan.sarif" ]; then
            echo "test_aquasec_scan.sarif not found in repository root"
            exit 1
          fi

      - name: Upload Scan Results to GitHub Security
        uses: github/codeql-action/upload-sarif@4e94bd11f71e507f7f87df81788dff88d1dacbfb
        with:
          sarif_file: test_aquasec_scan.sarif
          category: aquasec
